name: stack05
services:
  nginx:
    image: nginx:1.25
    container_name: stack05_nginx
    depends_on:
      - tomcat
    ports:
      - "8080:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - stack05_network

  tomcat:
    build:
      context: ./tomcat
    image: stack05/tomcat:9
    container_name: stack05_tomcat
    environment:
      - JAVA_OPTS=-Xms256m -Xmx512m
    ports:
      - "8081:8080"
    networks:
      - stack05_network

  samba-ad:
    image: nowsci/samba-domain:latest
    container_name: stack05_ad
    hostname: stack05-ad-local
    privileged: true
    environment:
      - DOMAIN=stack05.local
      - DOMAINPASS=Admin_Password_2025!
      - DNSFORWARDER=8.8.8.8
    volumes:
      - samba_data:/var/lib/samba
    ports:
      - "389:389"
      - "636:636"
    networks:
      - stack05_network

  ftp:
    image: fauria/vsftpd
    container_name: stack05_ftp
    environment:
      - FTP_USER=ftpuser
      - FTP_PASS=ftp_password_2025!
      - PASV_ADDRESS=127.0.0.1
      - PASV_MIN_PORT=21100
      - PASV_MAX_PORT=21110
    ports:
      - "21:21"
      - "21100-21110:21100-21110"
    volumes:
      - ftp_data:/home/vsftpd
    networks:
      - stack05_network

networks:
  stack05_network:
    driver: bridge

volumes:
  samba_data:
  ftp_data:
